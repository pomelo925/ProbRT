# Test docker configuration for robotics
base_image: osrf/ros:humble-desktop
base_image_gpu: nvidia/cuda:11.8-devel-ubuntu22.04
working_dir: /root/helloRobot_stretch3

# Port configuration
ports:
  expose: [8080, 11311]
  publish: "8080:8080"

# Service configuration  
service_name: dev
container_name: hellorobot_stretch3-dev

# Environment variables
environment:
  - HOME=/root/
  - HELLO_FLEET_ID=stretch-se3-3092
  - HELLO_FLEET_PATH=/root/stretch_user

# Volume mounts
volumes:
  - "./:/root/helloRobot_stretch3"

# Docker Compose settings
compose:
  version: "3.8"
  restart_policy: unless-stopped

# Build configuration
build:
  context: ".."
  dockerfile: "./docker/dockerfile.cpu"

# GPU support
gpu:
  enabled: false
  cuda_version: "11.8"

# Health check disabled for dev
healthcheck: null

# Advanced settings for robotics
advanced:
  gui_support:
    enabled: true
    x11_volumes:
      - "${XAUTHORITY:-$HOME/.Xauthority}:${XAUTHORITY:-/root/.Xauthority}"
      - "/tmp/.X11-unix:/tmp/.X11-unix"
      - "/etc/localtime:/etc/localtime:ro"
    environment:
      - DISPLAY=${DISPLAY}
  
  device_access:
    enabled: true
    volumes:
      - "/dev:/dev"
      - "/run/udev:/run/udev"
      - "/var/run/docker.sock:/var/run/docker.sock"
  
  network:
    mode: host
  
  privileged: true
  
  workspace_volumes:
    - "../stretch-se3-3092:/root/stretch_user/stretch-se3-3092"
    - "../stretch_install:/root/stretch_user/stretch_install"
    - "../colcon_ws:/root/helloRobot_stretch3/colcon_ws"
    - "../visualnav-transformer:/root/helloRobot_stretch3/visualnav-transformer"
  
  additional_env: []
