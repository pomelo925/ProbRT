# Example docker.yml for a ROS robotics project with advanced features

# Docker image settings
base_image: osrf/ros:humble-desktop  # ROS Humble base image
base_image_gpu: nvidia/cuda:11.8-devel-ubuntu22.04  # GPU base image
working_dir: /root/helloRobot_stretch3  # Working directory inside container

# Port configuration
ports:
  expose: [8080, 11311]  # ROS master port and web interface
  publish: "8080:8080"  # Port mapping for docker-compose

# Service configuration
service_name: dev  # Service name in docker-compose
container_name: hellorobot_stretch3-dev  # Container name

# Environment variables
environment:
  - HOME=/root/
  - HELLO_FLEET_ID=stretch-se3-3092
  - HELLO_FLEET_PATH=/root/stretch_user

# Volume mounts
volumes:
  - "./:/root/helloRobot_stretch3"  # Mount current directory

# Docker Compose settings
compose:
  version: "3.8"
  restart_policy: unless-stopped
  
# Build configuration
build:
  context: ".."
  dockerfile: "./docker/dockerfile.cpu"

# GPU support configuration
gpu:
  enabled: false
  cuda_version: "11.8"
  
# Health check (disabled for development containers)
healthcheck: null

# Advanced Docker Compose settings for robotics projects
advanced:
  # GUI support settings for ROS visualization
  gui_support:
    enabled: true
    x11_volumes:
      - "${XAUTHORITY:-$HOME/.Xauthority}:${XAUTHORITY:-/root/.Xauthority}"
      - "/tmp/.X11-unix:/tmp/.X11-unix"
      - "/etc/localtime:/etc/localtime:ro"
    environment:
      - DISPLAY=${DISPLAY}
  
  # Device access for hardware interaction
  device_access:
    enabled: true
    volumes:
      - "/dev:/dev"
      - "/run/udev:/run/udev"
      - "/var/run/docker.sock:/var/run/docker.sock"
    
  # Network settings
  network:
    mode: host  # Required for ROS communication
    
  # Container privileges for hardware access
  privileged: true
  
  # Workspace volumes (robot-specific)
  workspace_volumes:
    - "../stretch-se3-3092:/root/stretch_user/stretch-se3-3092"
    - "../stretch_install:/root/stretch_user/stretch_install" 
    - "../colcon_ws:/root/helloRobot_stretch3/colcon_ws"
    - "../visualnav-transformer:/root/helloRobot_stretch3/visualnav-transformer"
  
  # Additional environment variables
  additional_env: []
